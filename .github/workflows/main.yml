######################################################################################################################################################
# Copyright 2021 Evan H. Harding. All Rights Reserved.
#
# This is a GitHub Actions workflow file. It is written in YAML and specifies a series of commands that execute when certain events occur. Jobs
# consist of the following:
#
#   * INITIALIZE-ENVIRONMENT - Initializes an Ubuntu Virtual Environment Runner on GitHub.
#                            - Checks Out The `main` GitHub Repository Branch For Fan Fiction.com.
#                            - Installs Node.js and NPM so that we can retrieve all dependencies and build the application.
#
# {@link https://docs.github.com/en/actions/learn-github-actions/introduction-to-github-actions | Introduction to GitHub Actions}
######################################################################################################################################################

name : Fan Fiction.com CI Angular Build And Test

on :
  # Triggers The Workflow On `push` Events But Only For The `main` Branch
  push :
    branches :
      - main

  # Allows The Workflow To Be Run Manually From The `Actions` Tab
  workflow_dispatch :

stages :
  - initialize-environment
  - npm-dependencies-install

jobs :
  ########## JOB 1 - initialize-environment ##########
  initialize-environment :
    runs-on : ${{ matrix.os }}
    strategy :
      matrix :
        node-version : [15.10.0]
        os :
          - ubuntu-latest

    steps :
      - name : Configure Git Initial Branch Name
        run : |
          git config --global init.defaultBranch main

      - name : Repository Checkout
        uses : actions/checkout@v2
        with :
          path : ''
          repository : ${{ github.repository }}
          ref : main
          clean : true
          lfs : false
          persist-credentials : true
          ssh-strict : true
          submodules : true
          fetch-depth : 0

      - name : Node.js ${{ matrix.node-version }} Setup
        uses : actions/setup-node@v1
        with :
          node-version : ${{ matrix.node-version }}

  ########## JOB 2 - npm-dependencies-install ##########
  npm-dependencies-install :
    needs : initialize-environment
    runs-on : ${{ matrix.os }}
    strategy:
      matrix:
        os:
          - ubuntu-latest

    steps :
      - name : NPM Dependencies Install
        run : |
          npm install
